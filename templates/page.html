{% extends 'base.html' %}

{% block title %}{{ config.title }} | {{ page.title }}{% endblock title %}

{% block custom_css %}
<link href='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-carousel@4.0.4/dist/css/bulma-carousel.min.css">
{% endblock %}

{% block main %}
<main class='section'>
	<div class='container'>
		<div class='columns'>
			<div class='column is-three-fifths is-offset-one-fifth'>
				<article>
					<h1 class='title'>{{ page.title }}</h1>
					<h2 class='subtitle'>{{ page.description }}</h2>
					<div class='columns mb-0'>
						<div class='column'>
							{{ macros::page_publish_metadata(page=page) }}
						</div>
						<div class='column has-text-right-desktop'>
							{{ macros::page_content_metadata(page=page) }}
						</div>
					</div>

					<div class='columns mb-0'>
						<div class='column'>
							{% if page.taxonomies.categories %}
							{{ macros::render_categories(categories=page.taxonomies.categories) }}
							{% endif %}
						</div>
						<div class='column has-text-right-desktop'>
							{% if page.taxonomies.tags %}
							{{ macros::render_tags(tags=page.taxonomies.tags) }}
							{% endif %}
						</div>
					</div>

					{% if page.extra.toc %}
					<hr />
					<div class='content'>
						<p class='has-text-weight-bold'>Table of Contents</p>
						<ul>
							{% for h1 in page.toc %}
							<li>
								<a href='{{h1.permalink | safe}}'>{{ h1.title }}</a>
								{% if h1.children %}
								<ul>
									{% for h2 in h1.children %}
									<li>
										<a href='{{h2.permalink | safe}}'>{{ h2.title }}</a>
									</li>
									{% endfor %}
								</ul>
								{% endif %}
							</li>
							{% endfor %}
						</ul>
					</div>
					{% endif %}
					<hr />

					<div class='content has-text-justified'>
						{{ page.content | safe }}
					</div>

					<div class="container has-text-centered mt-6">
						{{ macros::page_share_links(page=page) }}
					</div>
				</article>

				<hr />
				{% if page.earlier or page.later or page.lighter or page.heavier %}
				<nav class='level mt-2'>
					{% if page.later %}
					<div class='level-item has-text-centered'>
						<a href='{{ page.later.permalink }}' class='button is-black is-outlined'>
							<span class='icon mr-2'><i
									class='fas fa-arrow-circle-left'></i></span>{{ page.later.title }}
						</a>
					</div>
					{% endif %}
					{% if page.earlier %}
					<div class='level-item has-text-centered'>
						<a href='{{ page.earlier.permalink }}' class='button is-black is-outlined'>
							{{ page.earlier.title }}<span class='icon ml-2'><i
									class='fas fa-arrow-circle-right'></i></span>
						</a>
					</div>
					{% endif %}

					{% if page.heavier %}
					<div class='level-item has-text-centered'>
						<a href='{{ page.heavier.permalink }}' class='button is-black is-outlined'>
							<span class='icon mr-2'><i
									class='fas fa-arrow-circle-left'></i></span>{{ page.heavier.title }}
						</a>
					</div>
					{% endif %}

					{% if page.lighter %}
					<div class='level-item has-text-centered'>
						<a href='{{ page.lighter.permalink }}' class='button is-black is-outlined'>
							{{ page.lighter.title }}<span class='icon ml-2'><i
									class='fas fa-arrow-circle-right'></i></span>
						</a>
					</div>
					{% endif %}
				</nav>
				{% endif %}
				{% if page.extra.comments and config.extra.commenting.hyvor %}
				<hr />
				<section id='hyvor-talk-view'></section>
				{% endif %}
			</div>
		</div>
	</div>
</main>
{% endblock main %}

{% block custom_js %}
<script async type='text/javascript' src='https://talk.hyvor.com/web-api/embed'></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
<script src="https://cdn.jsdelivr.net/npm/bulma-carousel@4.0.4/dist/js/bulma-carousel.min.js"></script>

<script type='text/javascript'>
	// initialize hyvor comments 
	var HYVOR_TALK_WEBSITE = {{ config.extra.commenting.hyvor }};
	var HYVOR_TALK_CONFIG = {
		url: window.location.href,
		id: window.btoa(encodeURIComponent(escape(window.location.href)))
	};

	bulmaCarousel.attach('#slider', {
		loop: true,
		initialSlide: 0,
		slidesToScroll: 1,
		slidesToShow: 1
	});

	// initialize mermaid
	mermaid.initialize({ startOnLoad: true });

	// initialize chart.js 
	var chartData = document.getElementById('chart-data').textContent;
	var ctx = document.getElementById('myChart').getContext('2d');
	var chart = new Chart(ctx, JSON.parse(chartData));

	// initialize mapbox gl
	mapboxgl.accessToken = '{{config.extra.mapbox.access_token}}';
	var lng = document.getElementById('map-lng').textContent;
	var lat = document.getElementById('map-lat').textContent;
	var zoom = document.getElementById('map-zoom').textContent;

	var map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/mapbox/streets-v11',
		center: [lng, lat],
		zoom: zoom
	});

	map.addControl(new mapboxgl.NavigationControl());

	var marker = new mapboxgl.Marker()
		.setLngLat([lng, lat])
		.addTo(map);
</script>
{% endblock %}